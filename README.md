# cosense 文件夹说明

本文件夹包含用于 Carla 0.9.15仿真平台的不同场景下车辆仿真、数据采集与分析的核心 Python 脚本。以下是每个脚本的功能简介：

---

## 1. 车辆与地图相关工具

- **Spectator.py**  
  连接 Carla 仿真环境，控制观众视角，获取并打印当前观众的位置信息和朝向。适合用于调试或场景观察。

- **Waypoint.py**  
  获取地图所有推荐的车辆生成点（spawn points），打印前10个作为起点候选，并选定起点和终点。适用于路径规划和车辆初始化。

- **map.py**  
  连接到 Carla 仿真环境，输出地图生成点信息、地图范围，并筛选街道上的生成点。用于场景规划和数据采集区域选择。

- **passtime.py**  
  自动控制车辆从起点行驶到终点，支持路径可视化、轨迹绘制和自动变道。包含自动资源清理，适合路径跟踪与仿真测试。

---

## 2. 数据采集与分析

- **sim.py / simcurve.py / simmmmm.py / sime.py / simp.py / sim_6.py / sim_our.py / sim_test1.py / simtest2.py / simnewtest1.py / simnewtest2.py / simnewtest3.py / simnewtest4.py / simnewtest5.py等**  
  不同场景下的仿真主脚本，包括道路违停、路况模拟、拥堵分析等。支持感知车辆、普通车辆、自动数据采集、红绿灯控制、交通流量统计、拥堵检测等，并自动保存图片与元数据。  
  这些脚本通过参数调整可实现如下功能：
  - 违停车辆生成
  - 感知车辆分布与摄像头数据采集
  - 普通车辆密集/拥挤交通仿真
  - 摄像头视频与车辆状态录制
  - 交通流量与拥堵统计
  - 多种天气、分辨率、红绿灯场景
  - 自动资源清理及异步/同步仿真模式

- **analyze_photos.py**  
  批量分析车辆采集的照片及其元数据，计算每辆车在不同位置的可见区域面积，自动评分并输出排名。适合进行感知能力评估和环境遮挡分析。

- **duqu.py**  
  使用 numpy 加载车辆深度相机的 `.npy` 数据文件，并打印出来。用于调试或分析感知数据。

---

## 3. 目录结构建议

- `output/camera_images/`：存放车辆采集到的图片及元数据。
- `output/analysis_results/`：存放图片分析结果（如排名与得分）。
- `output/parking_coordinates.txt`：部分脚本会记录停车坐标信息。
- 其他脚本如 sim_our.py 还会导出角速度、交通流量等 CSV 文件。

---

## 4. 依赖环境

- Python 3
- [Carla 仿真平台](https://carla.org/)
- numpy
- cv2 (OpenCV)
- 其他常用 Python 标准库

部分脚本依赖不同版本的 Carla，建议根据脚本注释及 Carla 官方文档选择合适版本。

---

## 5. 使用说明

1. 启动 Carla 仿真服务端（建议使用适配的地图，如 Town04, Town10HD 等）。
2. 按需运行不同脚本，如：
   - 数据采集与仿真主循环：`sim.py`、`simcurve.py`、`simnewtest1.py` 等
   - 路径分析与轨迹跟踪：`passtime.py`
   - 观众视角调试：`Spectator.py`
   - 可见区域分析：`analyze_photos.py`
3. 可根据实际场景修改脚本中的参数（如车辆数量、起终点位置、分辨率、仿真时间等）。
4. 推荐逐步调试，每次仿真结束注意资源清理。
5. 输出的图片、视频、数据文件可用于后续分析或论文结果展示。

---

## 6. 联系与反馈

如有问题或建议，欢迎邮箱联系xiang.chaocan@gmail.com。

---
